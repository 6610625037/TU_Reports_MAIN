{% extends 'base.html' %}
{% load static %}

{% block title %}‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - TU Report{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8 px-4">
  <div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800">üîî ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h1>
    <p class="text-sm text-gray-600 mt-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
  </div>

  <!-- Summary Stats -->
  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-600">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô</p>
        <p class="text-3xl font-bold text-red-600">{{ unread_count }}</p>
      </div>
      {% if unread_count > 0 %}
      <form method="post" action="{% url 'notify:mark_all_read' %}">
        {% csrf_token %}
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          ‚úÖ ‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </button>
      </form>
      {% endif %}
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-lg shadow p-4 mb-6">
    <form method="get" class="space-y-3">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Filter by Read Status -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô</label>
          <select name="read" onchange="this.form.submit()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="unread" {% if filter_read == 'unread' %}selected{% endif %}>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô</option>
            <option value="read" {% if filter_read == 'read' %}selected{% endif %}>‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
          </select>
        </div>

        <!-- Filter by Type -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
          <select name="type" onchange="this.form.submit()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500">
            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="NEW_TICKET" {% if filter_type == 'NEW_TICKET' %}selected{% endif %}>Ticket ‡πÉ‡∏´‡∏°‡πà</option>
            <option value="ASSIGNED" {% if filter_type == 'ASSIGNED' %}selected{% endif %}>‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</option>
            <option value="REASSIGNED" {% if filter_type == 'REASSIGNED' %}selected{% endif %}>‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</option>
            <option value="STATUS_CHANGE" {% if filter_type == 'STATUS_CHANGE' %}selected{% endif %}>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
            <option value="COMPLETED" {% if filter_type == 'COMPLETED' %}selected{% endif %}>‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</option>
            <option value="URGENT" {% if filter_type == 'URGENT' %}selected{% endif %}>‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
            <option value="COMMENT" {% if filter_type == 'COMMENT' %}selected{% endif %}>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</option>
            <option value="FEEDBACK" {% if filter_type == 'FEEDBACK' %}selected{% endif %}>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</option>
          </select>
        </div>
      </div>

      <!-- Clear Filters -->
      {% if filter_read or filter_type %}
      <div>
        <a href="{% url 'notify:list' %}" class="text-sm text-blue-600 hover:underline">
          üîÑ ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
        </a>
      </div>
      {% endif %}
    </form>
  </div>

  <!-- Notifications List -->
  <div class="space-y-3">
    {% if notifications %}
      {% for notif in notifications %}
      <div class="bg-white rounded-lg shadow hover:shadow-md transition-shadow {% if not notif.is_read %}border-l-4 border-red-500{% endif %}">
        <div class="p-4">
          <div class="flex items-start justify-between">
            <div class="flex-1">
              <!-- Icon + Type Badge -->
              <div class="flex items-center gap-2 mb-2">
                {% if notif.notification_type == 'NEW_TICKET' %}
                  <span class="text-2xl">üé´</span>
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded">Ticket ‡πÉ‡∏´‡∏°‡πà</span>
                {% elif notif.notification_type == 'ASSIGNED' %}
                  <span class="text-2xl">üë∑</span>
                  <span class="px-2 py-1 bg-purple-100 text-purple-800 text-xs font-medium rounded">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
                {% elif notif.notification_type == 'REASSIGNED' %}
                  <span class="text-2xl">üîÑ</span>
                  <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-medium rounded">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</span>
                {% elif notif.notification_type == 'STATUS_CHANGE' %}
                  <span class="text-2xl">üîî</span>
                  <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                {% elif notif.notification_type == 'COMPLETED' %}
                  <span class="text-2xl">‚úÖ</span>
                  <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded">‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</span>
                {% elif notif.notification_type == 'URGENT' %}
                  <span class="text-2xl">üö®</span>
                  <span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded">‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</span>
                {% elif notif.notification_type == 'COMMENT' %}
                  <span class="text-2xl">üí¨</span>
                  <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
                {% elif notif.notification_type == 'FEEDBACK' %}
                  <span class="text-2xl">‚≠ê</span>
                  <span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</span>
                {% endif %}

                {% if not notif.is_read %}
                  <span class="px-2 py-1 bg-red-600 text-white text-xs font-bold rounded">‡πÉ‡∏´‡∏°‡πà</span>
                {% endif %}
              </div>

              <!-- Title -->
              <h3 class="text-lg font-semibold text-gray-800 mb-1">{{ notif.title }}</h3>

              <!-- Message -->
              <p class="text-sm text-gray-600 mb-2">{{ notif.message }}</p>

              <!-- Ticket Link -->
              {% if notif.ticket %}
              <a href="{% url 'tickets:ticket_detail' notif.ticket.id %}" class="inline-block px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded hover:bg-gray-200">
                üé´ ‡∏î‡∏π Ticket #{{ notif.ticket.id }}
              </a>
              {% endif %}

              <!-- Timestamp -->
              <p class="text-xs text-gray-400 mt-3">
                üìÖ {{ notif.created_at|date:"d/m/Y H:i" }}
                {% if notif.is_read and notif.read_at %}
                  | ‚úì ‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏°‡∏∑‡πà‡∏≠ {{ notif.read_at|date:"d/m/Y H:i" }}
                {% endif %}
              </p>
            </div>

            <!-- Mark as Read Button -->
            {% if not notif.is_read %}
            <div class="ml-4">
              <form method="post" action="{% url 'notify:mark_read' notif.id %}">
                {% csrf_token %}
                <button type="submit" class="px-3 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700" title="‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß">
                  ‚úì
                </button>
              </form>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}

      <!-- Show More Info -->
      {% if notifications.count == 50 %}
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
        <p class="text-sm text-blue-800">
          ‡πÅ‡∏™‡∏î‡∏á 50 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        </p>
      </div>
      {% endif %}

    {% else %}
      <!-- Empty State -->
      <div class="bg-white rounded-lg shadow p-8 text-center">
        <div class="text-6xl mb-4">üîï</div>
        <h3 class="text-xl font-semibold text-gray-800 mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
        <p class="text-gray-600">
          {% if filter_read or filter_type %}
            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
          {% else %}
            ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ
          {% endif %}
        </p>
      </div>
    {% endif %}
  </div>
</div>

<!-- Auto-refresh script (optional) -->
<script>
// Auto-reload every 60 seconds to get new notifications
// setTimeout(() => location.reload(), 60000);
</script>
{% endblock %}
